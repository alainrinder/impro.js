/*! impro.js 31-03-2018 */

"use strict";var ImPro=new function(){};!function(r){r.extends=function(o,t){return t.prototype=function(t,e){function n(){this.constructor=e.prototype.constructor}return n.prototype=o.prototype,new n}(0,t),t.prototype.ParentClass=o,t},r.super=function(t,e){t.ParentClass.apply(t,e)},r.EnumItem=function(t,e){this.label=t,this.value=e},r.enum=function(t,e){"function"!=typeof e&&(e=r.EnumItem);var n={};if(t instanceof Array)for(var o=0;o<t.length;++o)n[t[o]]=new e(t[o],o);else for(var a in t)n[a]=new e(a,t[a]);return n}}(ImPro),function(f){function t(t,e,n,o,a){var r=window[t+"Array"],i=f.channelProfiles[e];this.dataType=t,this.arrayType=r,this.channelProfile=e,this.channelCount=i,this.width=n,this.height=o,this.dx=i,this.dy=n*i,this.length=n*o*i,this.data=new r(this.length),(a instanceof r||a instanceof Array)&&this.data.set(a)}function e(o,a){return f.extends(t,function(t,e,n){f.super(this,[o,a,t,e,n])})}f.dataTypes=["Uint8Clamped","Uint8","Uint16","Uint32","Int8","Int16","Int32","Float32","Float64"],f.channelProfiles={Gray:1,Rgb:3,Rgba:4},f.imageTypeGroups={all:[]};for(var n=0,o=f.dataTypes.length;n<o;++n)f.imageTypeGroups[f.dataTypes[n]]=[];for(var a in f.channelProfiles)f.imageTypeGroups[a]=[];function r(t,e){return t+e+"Image"}for(n=0,o=f.dataTypes.length;n<o;++n){var i=f.dataTypes[n];for(a in f.channelProfiles){var h=e(i,a);f[r(i,a)]=h,f.imageTypeGroups[i].push(h),f.imageTypeGroups[a].push(h),f.imageTypeGroups.all.push(h)}}f.getImageType=function(t,e){return f[r(t,e)]},f.Uint8ClampedRgbaImage.fromCanvas=function(t){var e=t.getContext("2d").getImageData(0,0,t.width,t.height);return new f.Uint8ClampedRgbaImage(t.width,t.height,e.data)},f.Uint8ClampedRgbaImage.fromDomImage=function(t){var e=document.createElement("canvas");return e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0),f.Uint8ClampedRgbaImage.fromCanvas(e)},f.Uint8ClampedRgbaImage.fromLocalFile=function(t,e){var n=new window.Image;n.addEventListener("load",function(){var t=f.Uint8ClampedRgbaImage.fromDomImage(n);e(t)},!1),n.src=t},f.Uint8ClampedRgbaImage.prototype.toCanvas=function(t){void 0===t&&((t=document.createElement("canvas")).width=this.width,t.height=this.height);var e=t.getContext("2d"),n=e.createImageData(t.width,t.height);return n.data.set(this.data),e.putImageData(n,0,0),t},f.Uint8ClampedRgbaImage.prototype.toDataURL=function(){var t=document.createElement("canvas");return t.width=this.width,t.height=this.height,this.toCanvas(t),t.toDataURL("image/png")},f.Uint8ClampedRgbaImage.prototype.toDomImage=function(t){return void 0===t&&(t=new window.Image),t.src=this.toDataURL(),t}}(ImPro),ImPro.Process=function(t,p,m,v){this.name=t,this.lastExecutionTime=null;for(var e=0;e<p.length;++e){var n=p[e];void 0===n.connectable&&(n.connectable=!0),void 0===n.configurable&&(n.configurable=!1),void 0===n.configOptions&&(n.configOptions={})}this.inputConfigs=p,this.outputConfigs=m,this.run=function(t){for(var e=[],n=0;n<p.length;++n){var o=p[n];if(void 0===t[n]){if(void 0===o.default)throw new Error('Missing input "'+o.name+'". Abort.');t[n]=o.default}for(var a=t[n],r=!1,i=0;i<o.types.length;++i){var f=o.types[i];("function"==typeof f&&a instanceof f||"string"==typeof f&&typeof a===f)&&(r=!0,e[n]=f)}if(!r)throw new Error('Invalid type for input "'+o.name+'". Abort.')}var h=performance.now(),s=v(e,t),u=performance.now();this.lastExecutionTime=u-h;for(var l=0;l<m.length;++l){var c=m[l];if(void 0===s[l])throw new Error('Missing output "'+c.name+'". Abort.');var g=s[l],d=c.type(e,t);if(!("function"==typeof d&&g instanceof d||"string"==typeof d&&typeof g===d))throw new Error('Invalid type for output "'+c.name+'". Abort.')}return s}},function(O){O.convolutionBorderPolicies=O.enum(["LeaveBlack","LeaveWhite","LeavePristine","CropKernel","SquashKernel","DuplicateBorder","MirrorImage"],O.convolutionBorderPolicy=O.EnumItem),O.convolution=new O.Process("Convolution",[{name:"Image",types:O.imageTypeGroups.all},{name:"Kernel",types:[O.Float32GrayImage],connectable:!0,configurable:!0},{name:"Normalize",types:["boolean"],default:!0,connectable:!1,configurable:!0},{name:"BorderPolicy",types:[O.convolutionBorderPolicy],default:O.convolutionBorderPolicies.SquashKernel,connectable:!1,configurable:!0}],[{name:"Image",type:function(t,e){return t[0]}}],function(t,e){var n=e[0],o=e[1],a=e[2],r=O.getImageType("Float32",n.channelProfile),i=t[0],f=new r(n.width,n.height),h=new i(f.width,f.height),s=n.data,u=f.data,l=h.data,c=n.width,g=n.height,d=o.width,p=o.height,m=o.width>>1,v=o.height>>1,y=m,w=c-m,I=v,b=g-v,C=0,P=0,T=n.dx,U=n.dy,R=0,E=0,x=d,D=0,G=0,L=0,A=0,B=0,M=0,F=0,K=0;for(E=0;E<p;++E)for(R=0;R<d;++R)if(0!==(D=o.data[E*x+1*R])){for(L=(R-m)*T+(E-v)*U,P=0;P<I;++P)for(C=0;C<y;++C)A=((F=C+R-m)<0?1-F:F)*T+((K=P+E-v)<0?1-K:K)*U,u[M=C*T+P*U]+=s[A]*D,u[M+1]+=s[A+1]*D,u[M+2]+=s[A+2]*D;for(P=0;P<I;++P)for(C=y;C<w;++C)A=((F=C+R-m)<0?1-F:F)*T+((K=P+E-v)<0?1-K:K)*U,u[M=C*T+P*U]+=s[A]*D,u[M+1]+=s[A+1]*D,u[M+2]+=s[A+2]*D;for(P=b;P<g;++P)for(C=0;C<w;++C)A=((F=C+R-m)<0?1-F:F)*T+((K=P+E-v)<g?K:2*g-K-1)*U,u[M=C*T+P*U]+=s[A]*D,u[M+1]+=s[A+1]*D,u[M+2]+=s[A+2]*D;for(P=I;P<b;++P)for(C=0;C<y;++C)A=((F=C+R-m)<0?1-F:F)*T+((K=P+E-v)<0?1-K:K)*U,u[M=C*T+P*U]+=s[A]*D,u[M+1]+=s[A+1]*D,u[M+2]+=s[A+2]*D;for(P=0;P<b;++P)for(C=w;C<c;++C)A=((F=C+R-m)<c?F:2*c-F-1)*T+((K=P+E-v)<0?1-K:K)*U,u[M=C*T+P*U]+=s[A]*D,u[M+1]+=s[A+1]*D,u[M+2]+=s[A+2]*D;for(P=b;P<g;++P)for(C=w;C<c;++C)A=((F=C+R-m)<c?F:2*c-F-1)*T+((K=P+E-v)<g?K:2*g-K-1)*U,u[M=C*T+P*U]+=s[A]*D,u[M+1]+=s[A+1]*D,u[M+2]+=s[A+2]*D}for(E=0;E<p;++E)for(R=0;R<d;++R)for(D=o.data[E*x+1*R],L=(R-m)*T+(E-v)*U,P=I;P<b;++P)for(C=y;C<w;++C)u[G=P*U+C*T]+=s[G+L]*D,u[G+1]+=s[G+L+1]*D,u[G+2]+=s[G+L+2]*D;if(a){var q=0;for(A=0,B=o.length;A<B;++A)q+=o.data[A];if(0===q)for(A=0,B=u.length;A<B;A+=f.dx)u[A]+=128,u[A+1]+=128,u[A+2]+=128;else for(A=0,B=u.length;A<B;A+=f.dx)u[A]/=q,u[A+1]/=q,u[A+2]/=q}for(A=0,B=u.length;A<B;A+=f.dx)l[A]=Math.round(u[A]),l[A+1]=Math.round(u[A+1]),l[A+2]=Math.round(u[A+2]),l[A+3]=255;return[h]})}(ImPro);