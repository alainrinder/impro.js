/*! impro.js 07-04-2018 */

"use strict";var ImPro=new function(){};!function(a){a.extends=function(o,t){return t.prototype=function(t,e){function n(){this.constructor=e.prototype.constructor}return n.prototype=o.prototype,new n}(0,t),t.prototype.ParentClass=o,t},a.super=function(t,e){t.ParentClass.apply(t,e)},a.EnumItem=function(t,e){this.label=t,this.value=e},a.enum=function(t,e){"function"!=typeof e&&(e=a.EnumItem);var n={};if(t instanceof Array)for(var o=0;o<t.length;++o)n[t[o]]=new e(t[o],o);else for(var r in t)n[r]=new e(r,t[r]);return n},a.typeof=function(t){return t===a?"ImPro":Object.prototype.toString.call(t).slice(8,-1)}}(ImPro),function(f){function t(t,e,n,o,r){var a=window[t+"Array"],i=f.channelProfiles[e];this.dataType=t,this.arrayType=a,this.channelProfile=e,this.channelCount=i,this.width=n,this.height=o,this.dx=i,this.dy=n*i,this.length=n*o*i,this.data=new a(this.length),(r instanceof a||r instanceof Array)&&this.data.set(r)}function e(o,r){return f.extends(t,function(t,e,n){f.super(this,[o,r,t,e,n])})}f.dataTypes=["Uint8Clamped","Uint8","Uint16","Uint32","Int8","Int16","Int32","Float32","Float64"],f.channelProfiles={Gray:1,Rgb:3,Rgba:4},f.imageTypeGroups={all:[]};for(var n=0,o=f.dataTypes.length;n<o;++n)f.imageTypeGroups[f.dataTypes[n]]=[];for(var r in f.channelProfiles)f.imageTypeGroups[r]=[];function a(t,e){return t+e+"Image"}for(n=0,o=f.dataTypes.length;n<o;++n){var i=f.dataTypes[n];for(r in f.channelProfiles){var u=e(i,r);f[a(i,r)]=u,f.imageTypeGroups[i].push(u),f.imageTypeGroups[r].push(u),f.imageTypeGroups.all.push(u)}}f.getImageType=function(t,e){return f[a(t,e)]},f.Uint8ClampedRgbaImage.fromCanvas=function(t){var e=t.getContext("2d").getImageData(0,0,t.width,t.height);return new f.Uint8ClampedRgbaImage(t.width,t.height,e.data)},f.Uint8ClampedRgbaImage.fromDomImage=function(t){var e=document.createElement("canvas");return e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0),f.Uint8ClampedRgbaImage.fromCanvas(e)},f.Uint8ClampedRgbaImage.fromLocalFile=function(t,e){var n=new window.Image;n.addEventListener("load",function(){var t=f.Uint8ClampedRgbaImage.fromDomImage(n);e(t)},!1),n.src=t},f.Uint8ClampedRgbaImage.prototype.toCanvas=function(t){void 0===t&&((t=document.createElement("canvas")).width=this.width,t.height=this.height);var e=t.getContext("2d"),n=e.createImageData(t.width,t.height);return n.data.set(this.data),e.putImageData(n,0,0),t},f.Uint8ClampedRgbaImage.prototype.toDataURL=function(){var t=document.createElement("canvas");return t.width=this.width,t.height=this.height,this.toCanvas(t),t.toDataURL("image/png")},f.Uint8ClampedRgbaImage.prototype.toDomImage=function(t){return void 0===t&&(t=new window.Image),t.src=this.toDataURL(),t}}(ImPro),ImPro.Process=function(t,m,d,v){this.name=t,this.lastExecutionTime=null;for(var e=0;e<m.length;++e){var n=m[e];void 0===n.connectable&&(n.connectable=!0),void 0===n.configurable&&(n.configurable=!1),void 0===n.configOptions&&(n.configOptions={})}this.inputConfigs=m,this.outputConfigs=d,this.run=function(t){for(var e=[],n=0;n<m.length;++n){var o=m[n];if(void 0===t[n]){if(void 0===o.default)throw new Error('Missing input "'+o.name+'". Abort.');t[n]=o.default}for(var r=t[n],a=!1,i=0;i<o.types.length;++i){var f=o.types[i];("function"==typeof f&&r instanceof f||"string"==typeof f&&typeof r===f)&&(a=!0,e[n]=f)}if(!a)throw new Error('Invalid type for input "'+o.name+'". Abort.')}var u=performance.now(),l=v(e,t),h=performance.now();this.lastExecutionTime=h-u;for(var s=0;s<d.length;++s){var c=d[s];if(void 0===l[s])throw new Error('Missing output "'+c.name+'". Abort.');var g=l[s],p=c.type(e,t);if(!("function"==typeof p&&g instanceof p||"string"==typeof p&&typeof g===p))throw new Error('Invalid type for output "'+c.name+'". Abort.')}return l}},function(z){z.convolutionKernelSum=function(t){for(var e=0,n=0;n<t.data.length;++n)e+=t.data[n];return e},z.convolutionKernels={Gaussian:function(t){for(var n=(1+(t>>1))/3,e=function(t,e){for(var n=new z.Float32GrayImage(t,t),o=t>>1,r=t,a=-o;a<=o;++a)for(var i=-o;i<=o;++i)n.data[(a+o)*r+1*(i+o)]=e(i,a);return n}(t,function(t,e){return Math.exp(-(t*t+e*e)/(n*n))}),o=z.convolutionKernelSum(e),r=0;r<e.data.length;++r)e.data[r]/=o;return e}},z.convolutionBorderPolicies=z.enum(["LeaveBlack","LeaveWhite","LeavePristine","CropImage","CropKernel","SquashKernel","DuplicateBorder","MirrorImage"],z.convolutionBorderPolicy=z.EnumItem),z.convolution=new z.Process("Convolution",[{name:"Image",types:z.imageTypeGroups.all},{name:"Kernel",types:[z.Float32GrayImage],connectable:!0,configurable:!0},{name:"Normalize",types:["boolean"],default:!0,connectable:!1,configurable:!0},{name:"BorderPolicy",types:[z.convolutionBorderPolicy],default:z.convolutionBorderPolicies.LeaveBlack,connectable:!1,configurable:!0}],[{name:"Image",type:function(t,e){return t[0]}}],function(t,e){var n=e[0],o=e[1],r=e[2],a=z.getImageType("Float32",n.channelProfile),i=t[0],f=new a(n.width,n.height),u=new i(f.width,f.height),l=n.data,h=f.data,s=u.data,c=o.data,g=(l.length,h.length),p=(s.length,z.channelProfiles[n.channelProfile]),m=0,d=n.width,v=n.height,y=o.width,w=o.height,I=o.width>>1,b=o.height>>1,C=I,P=d-I,T=b,U=v-b,R=0,E=0,x=n.dx,G=n.dy,D=0,L=0,B=0,A=0,K=o.dx,M=o.dy,F=0,S=0,O=x,k=0,j=0,q=0;for(A=0;A<w;++A)for(B=0;B<y;++B)if(0!==(F=c[A*M+B*K])){for(E=0;E<T;++E)for(R=0;R<C;++R)for(S=R*x+E*G,k=((D=R+B-I)<0?1-D:D)*x+((L=E+A-b)<0?1-L:L)*G,m=0;m<p;++m)h[S+m]+=l[k+m]*F;for(E=0;E<T;++E)for(R=C;R<P;++R)for(S=R*x+E*G,k=(D=R+B-I)*x+((L=E+A-b)<0?1-L:L)*G,m=0;m<p;++m)h[S+m]+=l[k+m]*F;for(E=0;E<T;++E)for(R=P;R<d;++R)for(S=R*x+E*G,k=((D=R+B-I)<d?D:2*d-D-1)*x+((L=E+A-b)<0?1-L:L)*G,m=0;m<p;++m)h[S+m]+=l[k+m]*F;for(E=T;E<U;++E)for(R=0;R<C;++R)for(S=R*x+E*G,k=((D=R+B-I)<0?1-D:D)*x+(L=E+A-b)*G,m=0;m<p;++m)h[S+m]+=l[k+m]*F;for(E=T;E<U;++E)for(R=P;R<d;++R)for(S=R*x+E*G,k=((D=R+B-I)<d?D:2*d-D-1)*x+(L=E+A-b)*G,m=0;m<p;++m)h[S+m]+=l[k+m]*F;for(E=U;E<v;++E)for(R=0;R<C;++R)for(S=R*x+E*G,k=((D=R+B-I)<0?1-D:D)*x+((L=E+A-b)<v?L:2*v-L-1)*G,m=0;m<p;++m)h[S+m]+=l[k+m]*F;for(E=U;E<v;++E)for(R=C;R<P;++R)for(S=R*x+E*G,k=(D=R+B-I)*x+((L=E+A-b)<v?L:2*v-L-1)*G,m=0;m<p;++m)h[S+m]+=l[k+m]*F;for(E=U;E<v;++E)for(R=P;R<d;++R)for(S=R*x+E*G,k=((D=R+B-I)<d?D:2*d-D-1)*x+((L=E+A-b)<v?L:2*v-L-1)*G,m=0;m<p;++m)h[S+m]+=l[k+m]*F}for(A=0;A<w;++A)for(B=0;B<y;++B)for(F=c[A*M+B*K],j=(B-I)*x+(A-b)*G,E=T;E<U;++E)for(R=C;R<P;++R)for(k=(S=E*G+R*x)+j,m=0;m<p;++m)h[S+m]+=l[k+m]*F;if(r)if(0===(q=z.convolutionKernelSum(o)))for(S=0;S<g;S+=O)h[S]+=128,h[S+1]+=128,h[S+2]+=128;else for(S=0;S<g;S+=O)h[S]/=q,h[S+1]/=q,h[S+2]/=q;for(S=0;S<g;S+=O)s[S]=Math.round(h[S]),s[S+1]=Math.round(h[S+1]),s[S+2]=Math.round(h[S+2]),s[S+3]=255;return[u]})}(ImPro);