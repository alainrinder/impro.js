/*! impro.js 31-03-2018 */

"use strict";var ImPro=new function(){};!function(r){r.extends=function(o,t){return t.prototype=function(t,e){function n(){this.constructor=e.prototype.constructor}return n.prototype=o.prototype,new n}(0,t),t.prototype.ParentClass=o,t},r.super=function(t,e){t.ParentClass.apply(t,e)},r.EnumItem=function(t,e){this.label=t,this.value=e},r.enum=function(t,e){"function"!=typeof e&&(e=r.EnumItem);var n={};if(t instanceof Array)for(var o=0;o<t.length;++o)n[t[o]]=new e(t[o],o);else for(var a in t)n[a]=new e(a,t[a]);return n}}(ImPro),function(f){function t(t,e,n,o,a){var r=window[t+"Array"],i=f.channelProfiles[e];this.dataType=t,this.arrayType=r,this.channelProfile=e,this.channelCount=i,this.width=n,this.height=o,this.dx=i,this.dy=n*i,this.length=n*o*i,this.data=new r(this.length),(a instanceof r||a instanceof Array)&&this.data.set(a)}function e(o,a){return f.extends(t,function(t,e,n){f.super(this,[o,a,t,e,n])})}f.dataTypes=["Uint8Clamped","Uint8","Uint16","Uint32","Int8","Int16","Int32","Float32","Float64"],f.channelProfiles={Gray:1,Rgb:3,Rgba:4},f.imageTypeGroups={all:[]};for(var n=0,o=f.dataTypes.length;n<o;++n)f.imageTypeGroups[f.dataTypes[n]]=[];for(var a in f.channelProfiles)f.imageTypeGroups[a]=[];function r(t,e){return t+e+"Image"}for(n=0,o=f.dataTypes.length;n<o;++n){var i=f.dataTypes[n];for(a in f.channelProfiles){var h=e(i,a);f[r(i,a)]=h,f.imageTypeGroups[i].push(h),f.imageTypeGroups[a].push(h),f.imageTypeGroups.all.push(h)}}f.getImageType=function(t,e){return f[r(t,e)]},f.Uint8ClampedRgbaImage.fromCanvas=function(t){var e=t.getContext("2d").getImageData(0,0,t.width,t.height);return new f.Uint8ClampedRgbaImage(t.width,t.height,e.data)},f.Uint8ClampedRgbaImage.fromDomImage=function(t){var e=document.createElement("canvas");return e.width=t.width,e.height=t.height,e.getContext("2d").drawImage(t,0,0),f.Uint8ClampedRgbaImage.fromCanvas(e)},f.Uint8ClampedRgbaImage.fromLocalFile=function(t,e){var n=new window.Image;n.addEventListener("load",function(){var t=f.Uint8ClampedRgbaImage.fromDomImage(n);e(t)},!1),n.src=t},f.Uint8ClampedRgbaImage.prototype.toCanvas=function(t){void 0===t&&((t=document.createElement("canvas")).width=this.width,t.height=this.height);var e=t.getContext("2d"),n=e.createImageData(t.width,t.height);return n.data.set(this.data),e.putImageData(n,0,0),t},f.Uint8ClampedRgbaImage.prototype.toDataURL=function(){var t=document.createElement("canvas");return t.width=this.width,t.height=this.height,this.toCanvas(t),t.toDataURL("image/png")},f.Uint8ClampedRgbaImage.prototype.toDomImage=function(t){return void 0===t&&(t=new window.Image),t.src=this.toDataURL(),t}}(ImPro),ImPro.Process=function(t,m,d,v){this.name=t,this.lastExecutionTime=null;for(var e=0;e<m.length;++e){var n=m[e];void 0===n.connectable&&(n.connectable=!0),void 0===n.configurable&&(n.configurable=!1),void 0===n.configOptions&&(n.configOptions={})}this.inputConfigs=m,this.outputConfigs=d,this.run=function(t){for(var e=[],n=0;n<m.length;++n){var o=m[n];if(void 0===t[n]){if(void 0===o.default)throw new Error('Missing input "'+o.name+'". Abort.');t[n]=o.default}for(var a=t[n],r=!1,i=0;i<o.types.length;++i){var f=o.types[i];("function"==typeof f&&a instanceof f||"string"==typeof f&&typeof a===f)&&(r=!0,e[n]=f)}if(!r)throw new Error('Invalid type for input "'+o.name+'". Abort.')}var h=performance.now(),s=v(e,t),l=performance.now();this.lastExecutionTime=l-h;for(var u=0;u<d.length;++u){var c=d[u];if(void 0===s[u])throw new Error('Missing output "'+c.name+'". Abort.');var g=s[u],p=c.type(e,t);if(!("function"==typeof p&&g instanceof p||"string"==typeof p&&typeof g===p))throw new Error('Invalid type for output "'+c.name+'". Abort.')}return s}},function(H){H.convolutionBorderPolicies=H.enum(["LeaveBlack","LeaveWhite","LeavePristine","CropImage","CropKernel","SquashKernel","DuplicateBorder","MirrorImage"],H.convolutionBorderPolicy=H.EnumItem),H.convolution=new H.Process("Convolution",[{name:"Image",types:H.imageTypeGroups.all},{name:"Kernel",types:[H.Float32GrayImage],connectable:!0,configurable:!0},{name:"Normalize",types:["boolean"],default:!0,connectable:!1,configurable:!0},{name:"BorderPolicy",types:[H.convolutionBorderPolicy],default:H.convolutionBorderPolicies.LeaveBlack,connectable:!1,configurable:!0}],[{name:"Image",type:function(t,e){return t[0]}}],function(t,e){var n=e[0],o=e[1],a=e[2],r=H.getImageType("Float32",n.channelProfile),i=t[0],f=new r(n.width,n.height),h=new i(f.width,f.height),s=n.data,l=f.data,u=h.data,c=o.data,g=(s.length,l.length),p=(u.length,c.length),m=H.channelProfiles[n.channelProfile],d=0,v=n.width,y=n.height,w=o.width,I=o.height,b=o.width>>1,C=o.height>>1,P=b,T=v-b,U=C,R=y-C,E=0,x=0,D=n.dx,G=n.dy,L=0,B=0,A=0,M=0,F=o.dx,K=o.dy,k=0,O=0,q=D,z=0,N=0,S=0,W=F,j=0;for(M=0;M<I;++M)for(A=0;A<w;++A)if(0!==(k=c[M*K+A*F])){for(x=0;x<U;++x)for(E=0;E<P;++E)for(O=E*D+x*G,z=((L=E+A-b)<0?1-L:L)*D+((B=x+M-C)<0?1-B:B)*G,d=0;d<m;++d)l[O+d]+=s[z+d]*k;for(x=0;x<U;++x)for(E=P;E<T;++E)for(O=E*D+x*G,z=(L=E+A-b)*D+((B=x+M-C)<0?1-B:B)*G,d=0;d<m;++d)l[O+d]+=s[z+d]*k;for(x=0;x<U;++x)for(E=T;E<v;++E)for(O=E*D+x*G,z=((L=E+A-b)<v?L:2*v-L-1)*D+((B=x+M-C)<0?1-B:B)*G,d=0;d<m;++d)l[O+d]+=s[z+d]*k;for(x=U;x<R;++x)for(E=0;E<P;++E)for(O=E*D+x*G,z=((L=E+A-b)<0?1-L:L)*D+(B=x+M-C)*G,d=0;d<m;++d)l[O+d]+=s[z+d]*k;for(x=U;x<R;++x)for(E=T;E<v;++E)for(O=E*D+x*G,z=((L=E+A-b)<v?L:2*v-L-1)*D+(B=x+M-C)*G,d=0;d<m;++d)l[O+d]+=s[z+d]*k;for(x=R;x<y;++x)for(E=0;E<T;++E)for(O=E*D+x*G,z=((L=E+A-b)<0?1-L:L)*D+((B=x+M-C)<y?B:2*y-B-1)*G,d=0;d<m;++d)l[O+d]+=s[z+d]*k;for(x=R;x<y;++x)for(E=0;E<T;++E)for(O=E*D+x*G,z=(L=E+A-b)*D+((B=x+M-C)<y?B:2*y-B-1)*G,d=0;d<m;++d)l[O+d]+=s[z+d]*k;for(x=R;x<y;++x)for(E=T;E<v;++E)for(O=E*D+x*G,z=((L=E+A-b)<v?L:2*v-L-1)*D+((B=x+M-C)<y?B:2*y-B-1)*G,d=0;d<m;++d)l[O+d]+=s[z+d]*k}for(M=0;M<I;++M)for(A=0;A<w;++A)for(k=c[M*K+A*F],N=(A-b)*D+(M-C)*G,x=U;x<R;++x)for(E=P;E<T;++E)for(z=(O=x*G+E*D)+N,d=0;d<m;++d)l[O+d]+=s[z+d]*k;if(a){for(S=0;S<p;S+=W)j+=c[S];if(0===j)for(O=0;O<g;O+=q)l[O]+=128,l[O+1]+=128,l[O+2]+=128;else for(O=0;O<g;O+=q)l[O]/=j,l[O+1]/=j,l[O+2]/=j}for(O=0;O<g;O+=q)u[O]=Math.round(l[O]),u[O+1]=Math.round(l[O+1]),u[O+2]=Math.round(l[O+2]),u[O+3]=255;return[h]})}(ImPro);